<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MiniSoccer - Szybki Mecz</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            text-align: center;
        }
        canvas {
            background-color: green;
            display: block;
            margin: 20px auto;
        }
        button {
            font-size: 18px;
            padding: 10px 20px;
            margin: 10px;
            background-color: #007bff;
            border: none;
            color: #fff;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>

    <div id="startScreen">
        <h1>MiniSoccer - Szybki Mecz</h1>
        <button id="startMatchBtn">Rozpocznij mecz</button>
    </div>

    <div id="gameScreen" class="hidden">
        <canvas id="gameCanvas" width="800" height="400"></canvas>
        <p id="scoreboard">Gole: 0</p>
        <button id="backToStartBtn">Powrót do menu</button>
    </div>

    <script>
        /* =============================
           CZĘŚĆ I. USTAWIENIA I INICJALIZACJA GRY
           ============================= */
        let canvas, ctx;
        let score = { goals: 0 };
        let ball;
        let fieldPlayers = [];
        let goalkeeper = {};
        let draggingPlayerIndex = null;
        let dragStart = { x: 0, y: 0 };
        let dragCurrent = { x: 0, y: 0 };
        let isDragging = false;
        const FRICTION = 0.98;
        const DRAG_IMPULSE_SCALE = 0.2;
        const BALL_COLLISION_IMPULSE = 7;
        const PLAYER_RADIUS = 16;
        const GOALKEEPER_RADIUS = 18;
        let gameAnimating = false;

        function initGame() {
            canvas = document.getElementById("gameCanvas");
            ctx = canvas.getContext("2d");

            ball = {
                x: canvas.width * 0.55,
                y: canvas.height / 2,
                radius: 8,
                dx: 0,
                dy: 0
            };

            fieldPlayers = [
                { x: canvas.width * 0.25, y: canvas.height * 0.3, radius: PLAYER_RADIUS, vx: 0, vy: 0 },
                { x: canvas.width * 0.25, y: canvas.height * 0.5, radius: PLAYER_RADIUS, vx: 0, vy: 0 },
                { x: canvas.width * 0.25, y: canvas.height * 0.7, radius: PLAYER_RADIUS, vx: 0, vy: 0 },
                { x: canvas.width * 0.35, y: canvas.height * 0.5, radius: PLAYER_RADIUS, vx: 0, vy: 0 }
            ];

            goalkeeper = { x: 60, y: canvas.height / 2, radius: GOALKEEPER_RADIUS, vx: 0, vy: 0 };
            score.goals = 0;
        }

        /* =============================
           CZĘŚĆ IV. PĘTLA GRY
           ============================= */
        function gameLoop() {
            if (!gameAnimating) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawField();
            updatePositions();
            checkCollisions();
            drawGameObjects();
            document.getElementById("scoreboard").innerText = "Gole: " + score.goals;
            requestAnimationFrame(gameLoop);
        }

        /* =============================
           CZĘŚĆ V. OBSŁUGA PRZECIĄGANIA GRACZA
           ============================= */
        function canvasMouseDown(e) {
            const rect = canvas.getBoundingClientRect();
            const mx = e.clientX - rect.left;
            const my = e.clientY - rect.top;

            for (let i = 0; i < fieldPlayers.length; i++) {
                const p = fieldPlayers[i];
                const dist = Math.hypot(mx - p.x, my - p.y);
                if (dist < p.radius) {
                    draggingPlayerIndex = i;
                    isDragging = true;
                    dragStart = { x: p.x, y: p.y };
                    dragCurrent = { x: mx, y: my };
                    break;
                }
            }
        }

        function canvasMouseMove(e) {
            if (!isDragging) return;
            const rect = canvas.getBoundingClientRect();
            dragCurrent.x = e.clientX - rect.left;
            dragCurrent.y = e.clientY - rect.top;
        }

        function canvasMouseUp(e) {
            if (!isDragging || draggingPlayerIndex === null) return;
            const dx = dragStart.x - dragCurrent.x;
            const dy = dragStart.y - dragCurrent.y;
            fieldPlayers[draggingPlayerIndex].vx = dx * DRAG_IMPULSE_SCALE;
            fieldPlayers[draggingPlayerIndex].vy = dy * DRAG_IMPULSE_SCALE;
            isDragging = false;
            draggingPlayerIndex = null;
        }

        function addCanvasEvents() {
            canvas.addEventListener("mousedown", canvasMouseDown);
            canvas.addEventListener("mousemove", canvasMouseMove);
            canvas.addEventListener("mouseup", canvasMouseUp);
        }

        /* =============================
           CZĘŚĆ VII. INICJALIZACJA ZDARZEŃ PO ŁADOWANIU DOM
           ============================= */
        document.addEventListener("DOMContentLoaded", () => {
            document.getElementById("startMatchBtn").addEventListener("click", () => {
                document.getElementById("startScreen").classList.add("hidden");
                document.getElementById("gameScreen").classList.remove("hidden");
                initGame();
                addCanvasEvents();
                gameAnimating = true;
                requestAnimationFrame(gameLoop);
            });

            document.getElementById("backToStartBtn").addEventListener("click", () => {
                gameAnimating = false;
                document.getElementById("gameScreen").classList.add("hidden");
                document.getElementById("startScreen").classList.remove("hidden");
            });
        });
    </script>

</body>
</html>
