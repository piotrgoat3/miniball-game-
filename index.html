<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MiniSoccer - Szybki Mecz</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap');

      body {
        font-family: 'Nunito', sans-serif;
        background-color: #e8f5e9;
        margin: 0;
        padding: 0;
        text-align: center;
      }

      /* Ekrany – startowy i mecz */
      #startScreen,
      #gameScreen {
        padding: 20px;
      }
      .hidden {
        display: none !important;
      }
      #startScreen h1 {
        font-size: 48px;
        margin-bottom: 20px;
      }
      #startScreen button {
        font-size: 20px;
        padding: 12px 24px;
        margin: 10px;
        cursor: pointer;
      }
      .start-options {
        margin-top: 20px;
      }
      /* Ekran meczu */
      #scoreboardContainer {
        margin-bottom: 10px;
      }
      #scoreboard {
        font-size: 26px;
        font-weight: bold;
        margin: 0;
        padding: 0;
      }
      /* Pole gry – canvas z boiskiem */
      canvas {
        background-color: green;
        border: 4px solid #fff;
        display: block;
        margin: 0 auto;
      }
      /* Modale – baza zawodników oraz wybór języka */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 20;
      }
      .modal-content {
        background: #fff;
        padding: 20px;
        width: 90%;
        max-width: 500px;
        border-radius: 8px;
      }
      /* Formularze – inputy i przyciski */
      input,
      button {
        font-size: 16px;
        margin: 5px 0;
        padding: 8px;
        width: 100%;
        box-sizing: border-box;
      }
    </style>
  </head>
  <body>
    <!-- Ekran startowy -->
    <div id="startScreen">
      <h1>MiniSoccer ⚽</h1>
      <button id="startMatchBtn">SZYBKI MECZ</button>
      <div class="start-options">
        <button id="btnPlayerDB">Baza zawodników</button>
        <button id="btnLanguage">Język</button>
        <button id="btnSettings">Ustawienia</button>
      </div>
    </div>

    <!-- Ekran meczu (domyślnie ukryty) -->
    <div id="gameScreen" class="hidden">
      <div id="scoreboardContainer">
        <h2 id="scoreboard">0 - 0</h2>
      </div>
      <canvas id="gameCanvas" width="800" height="500"></canvas>
      <button id="backToStart">Powrót do Menu</button>
    </div>

    <!-- Modal bazy zawodników -->
    <div id="playerDBModal" class="modal hidden">
      <div class="modal-content">
        <h2>Baza zawodników</h2>
        <div id="playerList"></div>
        <h3>Dodaj zawodnika</h3>
        <form id="addPlayerForm">
          <input type="text" id="playerName" placeholder="Imię i nazwisko" required />
          <input type="text" id="playerTeam" placeholder="Drużyna" required />
          <input type="number" id="playerRating" placeholder="Ocena" required min="0" max="100" />
          <button type="submit">Dodaj</button>
        </form>
        <button id="closePlayerDB">Zamknij</button>
      </div>
    </div>

    <!-- Modal wyboru języka -->
    <div id="languageModal" class="modal hidden">
      <div class="modal-content">
        <h2>Wybór języka</h2>
        <p>Wybierz język interfejsu:</p>
        <button class="langOption" data-lang="pl">Polski</button>
        <button class="langOption" data-lang="en">English</button>
        <button id="closeLanguageModal">Zamknij</button>
      </div>
    </div>

    <script>
      /* ---------------------------
         KOD ROZGRYWKI (TRYB SZYBKIEGO MECZU)
         ---------------------------
         Inspiracja grami Miniball (DVAVI):
         - Drużyna 4+1: 4 zawodników outfield (sterowanych przez przeciąganie myszką)
           + 1 bramkarz (nieprzesuwalny)
         - Przy przeciąganiu wyświetlana jest przerywana linia wskazująca trajektorię.
         - Po zwolnieniu przycisku myszki zawodnik otrzymuje impuls ruchu.
         - Jeśli dotknie piłki, zostaje ona "kopnięta" – piłka otrzymuje impuls.
      */

      // Globalne zmienne
      let canvas, ctx;
      let score = { goals: 0 };
      let ball;
      const FRICTION = 0.98;
      const IMPULSE = 7; // siła uderzenia dla zawodnika
      const BALL_IMPULSE = 8; // siła uderzenia piłki przy kontakcie

      // Drużyna: 4 outfield players oraz 1 bramkarz
      let fieldPlayers = []; // sterowane przez gracza
      let goalkeeper = {};     // bramkarz - statyczny

      // Dla przeciągania
      let draggingPlayerIndex = null;
      let dragStart = { x: 0, y: 0 };
      let dragCurrent = { x: 0, y: 0 };
      let isDragging = false;

      // Inicjalizacja obiektów gry
      function initGame() {
        canvas = document.getElementById("gameCanvas");
        ctx = canvas.getContext("2d");

        // Inicjalizacja piłki na środku
        ball = {
          x: canvas.width * 0.55,
          y: canvas.height / 2,
          radius: 8,
          dx: 0,
          dy: 0,
        };

        // Inicjalizacja 4 zawodników outfield - rozstawienie na lewej połowie
        fieldPlayers = [
          { x: canvas.width * 0.25, y: canvas.height * 0.3, radius: 16, vx: 0, vy: 0 },
          { x: canvas.width * 0.25, y: canvas.height * 0.5, radius: 16, vx: 0, vy: 0 },
          { x: canvas.width * 0.25, y: canvas.height * 0.7, radius: 16, vx: 0, vy: 0 },
          { x: canvas.width * 0.35, y: canvas.height * 0.5, radius: 16, vx: 0, vy: 0 },
        ];

        // Inicjalizacja bramkarza (na bardzo lewym brzegu)
        goalkeeper = {
          x: 40,
          y: canvas.height / 2,
          radius: 18,
          vx: 0,
          vy: 0,
        };

        // Reset wyniku
        score.goals = 0;
      }

      // Rysowanie boiska
      function drawField() {
        ctx.strokeStyle = "#fff";
        ctx.lineWidth = 4;
        // Obrys (margines 10px)
        ctx.strokeRect(10, 10, canvas.width - 20, canvas.height - 20);

        // Linia środkowa – pozioma linia dzieląca boisko (dla uproszczenia)
        ctx.beginPath();
        ctx.moveTo(canvas.width * 0.6, 10);
        ctx.lineTo(canvas.width * 0.6, canvas.height - 10);
        ctx.stroke();

        // Bramki – tylko po prawej stronie (przeciwnik)
        ctx.fillStyle = "white";
        // cel bramkowy: prostokąt po prawej krawędzi, wysokość 100px na środku
        ctx.fillRect(canvas.width - 10, canvas.height / 2 - 50, 10, 100);

        // Bannery reklamowe (żółte paski u góry i dołu)
        ctx.fillStyle = "yellow";
        ctx.fillRect(10, 0, canvas.width - 20, 10);
        ctx.fillRect(10, canvas.height - 10, canvas.width - 20, 10);
      }

      // Rysowanie obiektów gry: piłki, zawodników i bramkarza
      function drawGameObjects() {
        // Piłka (biała)
        ctx.beginPath();
        ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
        ctx.fillStyle = "white";
        ctx.fill();
        ctx.closePath();

        // Outfield players (np. niebiescy)
        fieldPlayers.forEach((player) => {
          ctx.beginPath();
          ctx.arc(player.x, player.y, player.radius, 0, Math.PI * 2);
          ctx.fillStyle = "blue";
          ctx.fill();
          ctx.closePath();
        });

        // Bramkarz (np. zielony lub czarny)
        ctx.beginPath();
        ctx.arc(goalkeeper.x, goalkeeper.y, goalkeeper.radius, 0, Math.PI * 2);
        ctx.fillStyle = "black";
        ctx.fill();
        ctx.closePath();

        // Jeśli aktualnie przeciągamy gracza - rysujemy przerywaną linię
        if (isDragging && draggingPlayerIndex !== null) {
          ctx.save();
          ctx.setLineDash([5, 5]);
          ctx.strokeStyle = "red";
          ctx.lineWidth = 2;
          let p = fieldPlayers[draggingPlayerIndex];
          ctx.beginPath();
          ctx.moveTo(p.x, p.y);
          ctx.lineTo(dragCurrent.x, dragCurrent.y);
          ctx.stroke();
          ctx.restore();
        }
      }

      // Aktualizacja pozycji obiektów: zawodników, piłki
      function updatePositions() {
        // Aktualizujemy pozycje zawodników outfield
        fieldPlayers.forEach((player) => {
          player.x += player.vx;
          player.y += player.vy;
          // Tarcie
          player.vx *= FRICTION;
          player.vy *= FRICTION;
        });
        // Bramkarz – pozostaje statyczny, ale można ewentualnie dodać drobne ruchy
        // Aktualizacja piłki
        ball.x += ball.dx;
        ball.y += ball.dy;
        ball.dx *= FRICTION;
        ball.dy *= FRICTION;

        // Odbicie piłki od górnej/dolnej krawędzi
        if (ball.y - ball.radius < 10) {
          ball.y = 10 + ball.radius;
          ball.dy *= -1;
        }
        if (ball.y + ball.radius > canvas.height - 10) {
          ball.y = canvas.height - 10 - ball.radius;
          ball.dy *= -1;
        }

        // Jeśli piłka trafia do miejsca bramkowym (po prawej krawędzi)
        if (ball.x + ball.radius > canvas.width) {
          score.goals++;
          resetBall();
        }
      }

      // Reset piłki do centrum po golu
      function resetBall() {
        ball.x = canvas.width / 2;
        ball.y = canvas.height / 2;
        ball.dx = 0;
        ball.dy = 0;
      }

      // Prosta obsługa kolizji między okręgami
      function circleCollision(c1, c2) {
        let dx = c1.x - c2.x;
        let dy = c1.y - c2.y;
        return Math.hypot(dx, dy) < (c1.radius + c2.radius);
      }

      // Jeśli zawodnik (outfield gracz) dotknie piłki, nadaj piłce impuls
      function handlePlayerBallCollision(player) {
        if (circleCollision(player, ball)) {
          let dx = ball.x - player.x;
          let dy = ball.y - player.y;
          let dist = Math.hypot(dx, dy) || 1;
          ball.dx = (dx / dist) * BALL_IMPULSE;
          ball.dy = (dy / dist) * BALL_IMPULSE;
        }
      }

      // Główna pętla gry
      function gameLoop() {
        if (!gameAnimating) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawField();
        updatePositions();
        // Sprawdź kolizje dla każdego gracza
        fieldPlayers.forEach((player) => {
          handlePlayerBallCollision(player);
        });
        // Dla bramkarza
        handlePlayerBallCollision(goalkeeper);
        drawGameObjects();
        document.getElementById("scoreboard").innerText = "Gole: " + score.goals;
        requestAnimationFrame(gameLoop);
      }

      // Obsługa zdarzeń myszy na canvasie – przeciąganie zawodników
      function canvasMouseDown(e) {
        const rect = canvas.getBoundingClientRect();
        const mx = e.clientX - rect.left;
        const my = e.clientY - rect.top;
        // Sprawdź, czy kliknięto na któregoś z outfield graczy (pierwsze 4)
        for (let i = 0; i < fieldPlayers.length; i++) {
          let p = fieldPlayers[i];
          let dist = Math.hypot(mx - p.x, my - p.y);
          if (dist < p.radius) {
            draggingPlayerIndex = i;
            isDragging = true;
            dragStart = { x: p.x, y: p.y };
            dragCurrent = { x: mx, y: my };
            break;
          }
        }
      }

      function canvasMouseMove(e) {
        if (!isDragging) return;
        const rect = canvas.getBoundingClientRect();
        dragCurrent.x = e.clientX - rect.left;
        dragCurrent.y = e.clientY - rect.top;
      }

      function canvasMouseUp(e) {
        if (!isDragging || draggingPlayerIndex === null) return;
        // Oblicz impuls: kierunek = (dragStart - dragCurrent)
        const dx = dragStart.x - dragCurrent.x;
        const dy = dragStart.y - dragCurrent.y;
        const scale = 0.1; // Dostosuj siłę impulsu
        fieldPlayers[draggingPlayerIndex].vx = dx * scale;
        fieldPlayers[draggingPlayerIndex].vy = dy * scale;
        // Zakończ przeciąganie
        isDragging = false;
        draggingPlayerIndex = null;
      }

      // Dodaj zdarzenia myszy do canvas
      function addCanvasEvents() {
        canvas.addEventListener("mousedown", canvasMouseDown);
        canvas.addEventListener("mousemove", canvasMouseMove);
        canvas.addEventListener("mouseup", canvasMouseUp);
      }

      /* ---------------------------
         MODALE: Baza zawodników i Język
      --------------------------- */
      function toggleModal(modalId, show) {
        const modal = document.getElementById(modalId);
        if (show) {
          modal.classList.remove("hidden");
        } else {
          modal.classList.add("hidden");
        }
      }

      // Zamknięcie modala przez kliknięcie poza zawartość
      document.getElementById("playerDBModal").addEventListener("click", function (e) {
        if (e.target === this) toggleModal("playerDBModal", false);
      });
      document.getElementById("languageModal").addEventListener("click", function (e) {
        if (e.target === this) toggleModal("languageModal", false);
      });

      // Baza zawodników – localStorage
      function loadPlayers() {
        let players = localStorage.getItem("players");
        if (players) {
          return JSON.parse(players);
        } else {
          const defaultPlayers = [
            { name: "Lionel Messi", team: "Paris Saint-Germain", rating: 94 },
            { name: "Cristiano Ronaldo", team: "Manchester United", rating: 93 },
            { name: "Kylian Mbappe", team: "Paris Saint-Germain", rating: 92 },
            { name: "Neymar Jr", team: "Paris Saint-Germain", rating: 91 },
            { name: "Robert Lewandowski", team: "Bayern Munich", rating: 91 },
            { name: "Kevin De Bruyne", team: "Manchester City", rating: 91 },
            { name: "Virgil van Dijk", team: "Liverpool", rating: 90 },
            { name: "Mohamed Salah", team: "Liverpool", rating: 90 },
            { name: "Sadio Mane", team: "Liverpool", rating: 89 },
            { name: "Jan Oblak", team: "Atletico Madrid", rating: 90 },
            { name: "Manuel Neuer", team: "Bayern Munich", rating: 89 },
            { name: "Erling Haaland", team: "Borussia Dortmund", rating: 90 },
            { name: "Harry Kane", team: "Tottenham Hotspur", rating: 89 },
            { name: "Karim Benzema", team: "Real Madrid", rating: 90 },
            { name: "Luka Modric", team: "Real Madrid", rating: 89 },
            { name: "N'Golo Kante", team: "Chelsea", rating: 90 },
            { name: "Joshua Kimmich", team: "Bayern Munich", rating: 89 },
            { name: "Bruno Fernandes", team: "Manchester United", rating: 88 },
            { name: "Romelu Lukaku", team: "Chelsea", rating: 88 },
            { name: "Heung-Min Son", team: "Tottenham Hotspur", rating: 89 },
            { name: "David de Gea", team: "Manchester United", rating: 87 },
            { name: "Pedri", team: "Barcelona", rating: 88 },
            { name: "Frenkie de Jong", team: "Barcelona", rating: 88 },
            { name: "Raheem Sterling", team: "Chelsea", rating: 87 },
            { name: "Bernardo Silva", team: "Manchester City", rating: 88 },
            { name: "Rodri", team: "Manchester City", rating: 88 },
            { name: "Vinicius Jr", team: "Real Madrid", rating: 87 },
            { name: "Lautaro Martinez", team: "Inter Milan", rating: 87 },
            { name: "Casemiro", team: "Manchester United", rating: 87 },
            { name: "Jadon Sancho", team: "Manchester United", rating: 86 }
          ];
          localStorage.setItem("players", JSON.stringify(defaultPlayers));
          return defaultPlayers;
        }
      }
      function savePlayers(players) {
        localStorage.setItem("players", JSON.stringify(players));
      }
      function renderPlayerList() {
        const players = loadPlayers();
        const listContainer = document.getElementById("playerList");
        listContainer.innerHTML = "";
        if (players.length === 0) {
          listContainer.innerHTML = "<p>Brak zawodników w bazie.</p>";
          return;
        }
        players.forEach((player) => {
          const p = document.createElement("p");
          p.innerText = `${player.name} (${player.team}) - Ocena: ${player.rating}`;
          listContainer.appendChild(p);
        });
      }

      // Obsługa zmian językowych – przykładowe tłumaczenia
      function updateLanguageContent(lang) {
        const translations = {
          pl: {
            header: "MiniSoccer ⚽",
            startMatchBtn: "SZYBKI MECZ",
            btnPlayerDB: "Baza zawodników",
            btnLanguage: "Język",
            btnSettings: "Ustawienia",
            backToStart: "Powrót do Menu",
            playerDBModalHeader: "Baza zawodników",
            addPlayerFormHeader: "Dodaj zawodnika",
            playerNamePlaceholder: "Imię i nazwisko",
            playerTeamPlaceholder: "Drużyna",
            playerRatingPlaceholder: "Ocena",
            addPlayerButton: "Dodaj",
            closePlayerDB: "Zamknij",
            languageModalHeader: "Wybór języka",
            languageModalText: "Wybierz język interfejsu:",
            closeLanguageModal: "Zamknij"
          },
          en: {
            header: "MiniSoccer ⚽",
            startMatchBtn: "Quick Match",
            btnPlayerDB: "Player Database",
            btnLanguage: "Language",
            btnSettings: "Settings",
            backToStart: "Back to Menu",
            playerDBModalHeader: "Player Database",
            addPlayerFormHeader: "Add Player",
